<template>
    <template if:true={spinner}>
        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
    </template>
    <div class="slds-box" style="background: white;">
        <div class="slds-card">
            <lightning-layout vertical-align="center" class="x-large">
                <lightning-layout-item flexibility="auto" padding="around-small" size="2">
                    Franchise
                </lightning-layout-item>
                <lightning-layout-item flexibility="auto" padding="around-small" size="4">
                    <lightning-combobox name="franchise"
                                        options={franchiseOptions}
                                        onchange={handleChange}
                                        variant="label-hidden"
                                        placeholder="Select"></lightning-combobox>
                </lightning-layout-item>
            </lightning-layout>
            <lightning-layout vertical-align="center" class="x-large">
                <lightning-layout-item flexibility="auto" padding="around-small" size="2">
                    Production Month
                </lightning-layout-item>
                <lightning-layout-item flexibility="auto" padding="around-small" size="4">
                    <lightning-input type="date"
                                     name="production_month"
                                     onchange={handleChange}
                                     variant="label-hidden"
                                     placeholder="Select a date"></lightning-input>
                </lightning-layout-item>
            </lightning-layout>
            <div style="text-align:center;padding:10px">
                <button type="button"
                        class="slds-button slds-button_brand"
                        onclick={searchTMSPO}>Search</button>
            </div>
            <!-- Table level 1 - TMS PO-->
            <template if:true={haveTMSPOs}>
                <div class="slds-card__body" style="height: 100%">
                    <table class="slds-no-row-hover slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered slds-resizable">
                        <thead>
                            <tr class="slds-line-height_reset first">
                                <th class="slds-size_1-of-12">
                                    
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Account Name">Name</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Account Name">Total SVM Quantity</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Account Name">Franchise</div>
                                </th>
                                <th class="" scope="col">
                                    <div class="slds-truncate" title="Account Name">Created Date</div>
                                </th>                                
                            </tr>                            
                        </thead>
                        <tbody>
                            <template for:each={listWrapper} for:item="wp">
                                <tr key={wp.tmsRecord.Id}>
                                    <td>
                                        <lightning-button-icon icon-name="utility:down" 
                                                                size="small" 
                                                                alternative-text="View More" 
                                                                class="slds-m-left_xx-small"
                                                                onclick={handleShowDetail}
                                                                data-tmspo-id={wp.tmsRecord.Id}
                                                                ></lightning-button-icon>
                                    </td>
                                    <td>
                                        <lightning-tile label={wp.tmsRecord.Name} href={wp.tmsRecord.nameUrl}>

                                        </lightning-tile>
                                    </td>
                                    <td>{wp.tmsRecord.Total_Quantity__c}</td>
                                    <td>{wp.tmsRecord.Franchise__c}</td>
                                    <td>{wp.tmsRecord.CreatedDate}</td>                                 
                                </tr>
                                
                                <tr data-id={wp.tmsRecord.Id} key={wp.tmsRecord.Id} style="visibility: collapse;">  
                                    <td>&nbsp;</td>                               
                                    <td colspan="4">
                                        <div>
                                            <div if:true={wp.tmsRecord.haveFOBContract}><b>Forward FOB Contract</b></div>
                                            <div if:false={wp.tmsRecord.haveFOBContract}><b>There is no record of Forward FOB Contract</b></div>
                                            <table if:true={wp.tmsRecord.haveFOBContract}>
                                            
                                                <thead>
                                                    <tr class="slds-line-height_reset first">
                                                        <th class="slds-size_1-of-12">
                                    
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Name">Name</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Created Date</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Quantity</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Status</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={wp.fobWrappers} for:item="fobWp">
                                                        <tr key={fobWp.fobContract.Id}>
                                                            <td>
                                                                <lightning-button-icon icon-name="utility:down" 
                                                                                        size="small" 
                                                                                        alternative-text="View More" 
                                                                                        class="slds-m-left_xx-small"
                                                                                        onclick={handleShowFOBAdditonal}
                                                                                        data-fob-id ={fobWp.fobContract.Id}
                                                                                        ></lightning-button-icon>
                                                            </td>
                                                            <td>
                                                                <lightning-tile label={fobWp.fobContract.Name} href={fobWp.fobContract.nameUrl}></lightning-tile>
                                                            </td>
                                                            <td>{fobWp.fobContract.CreatedDate}</td>  
                                                            <td>{fobWp.fobContract.Quantity__c}</td>  
                                                            <td>{fobWp.fobContract.Status__c}</td>                                                      
                                                        </tr>
                                                        <!--FOB Additional -->
                                                        <tr data-id ={fobWp.fobContract.Id} key={fobWp.fobContract.Id} style="visibility: collapse;">  
                                                            <td>&nbsp;</td>                               
                                                            <td colspan="4">
                                                                <div>
                                                                    <div if:true={fobWp.fobContract.haveFOBAdditional}><b>FOB Additional Contract</b></div>
                                                                    <div if:false={fobWp.fobContract.haveFOBAdditional}><b>There is no record of FOB Additional Contract</b></div>
                                                                    <table if:true={fobWp.fobContract.haveFOBAdditional}>
                                                                    <!-- <table> -->
                                                                        <thead>
                                                                            <tr class="slds-line-height_reset first">
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Name">Name</div>
                                                                                </th>
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Created Date">Created Date</div>
                                                                                </th>
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Created Date">Status</div>
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <template for:each={fobWp.fobAddContracts} for:item="fobAdditional">
                                                                                <tr key={fobAdditional.Id}>
                                                                                    <td>
                                                                                        <lightning-tile label={fobAdditional.Name} href={fobAdditional.nameUrl}></lightning-tile>
                                                                                    </td>
                                                                                    <td>{fobAdditional.CreatedDate}</td>
                                                                                    <td>{fobAdditional.Status__c}</td>                                                        
                                                                                </tr>
                                                                            </template>
                                                                        </tbody>
                                                                    </table>                                                                    
                                                                </div>                                        
                                                            </td>                     
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                            <br>
                                            <div if:true={wp.tmsRecord.haveDutyContract}><b>Forward Duty Contract</b></div> 
                                            <div if:false={wp.tmsRecord.haveDutyContract}><b>There is no record of Forward Duty Contract</b></div>                                         
                                            <table if:true={wp.tmsRecord.haveDutyContract}>                                                
                                                <thead>
                                                    <tr class="slds-line-height_reset first">
                                                        <th class="slds-size_1-of-12">
                                    
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Name">Name</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Created Date</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Quantity</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Status</div>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                    <template for:each={wp.dutyWrappers} for:item="dutyWp">
                                                        <tr key={dutyWp.dutyContract.Id}>
                                                            <td>
                                                                <lightning-button-icon icon-name="utility:down" 
                                                                                        size="small" 
                                                                                        alternative-text="View More" 
                                                                                        class="slds-m-left_xx-small"
                                                                                        onclick={handleShowDutyAdditonal}
                                                                                        data-duty-id ={dutyWp.dutyContract.Id}
                                                                                        ></lightning-button-icon>
                                                            </td>
                                                            <td>
                                                                <lightning-tile label={dutyWp.dutyContract.Name} href={dutyWp.dutyContract.nameUrl}></lightning-tile>
                                                            </td>
                                                            <td>{dutyWp.dutyContract.CreatedDate}</td> 
                                                            <td>{dutyWp.dutyContract.Quantity__c}</td>  
                                                            <td>{dutyWp.dutyContract.Status__c}</td>                                                       
                                                        </tr>

                                                        <!--Duty Additional -->
                                                        <tr data-id ={dutyWp.dutyContract.Id} key={dutyWp.dutyContract.Id} style="visibility: collapse;">  
                                                            <td>&nbsp;</td>                               
                                                            <td colspan="4">
                                                                <div>
                                                                    <div if:true={dutyWp.dutyContract.haveDutyAdditional}><b>Duty Additional Contract</b></div>
                                                                    <div if:false={dutyWp.dutyContract.haveDutyAdditional}><b>There is no record of Duty Additional Contract</b></div>
                                                                    <table if:true={dutyWp.dutyContract.haveDutyAdditional}>
                                                                    <!-- <table> -->
                                                                        <thead>
                                                                            <tr class="slds-line-height_reset first">
                                                                                
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Name">Name</div>
                                                                                </th>
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Created Date">Created Date</div>
                                                                                </th>
                                                                                <th class="" scope="col">
                                                                                    <div class="slds-truncate" title="Created Date">Status</div>
                                                                                </th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <template for:each={dutyWp.dutyAddContracts} for:item="dutyAdditional">
                                                                                <tr key={dutyAdditional.Id}>
                                                                                    <td></td>
                                                                                    <td>
                                                                                        <lightning-tile label={dutyAdditional.Name} href={dutyAdditional.nameUrl}></lightning-tile>
                                                                                    </td>
                                                                                    <td>{dutyAdditional.CreatedDate}</td>    
                                                                                    <td>{dutyAdditional.Status__c}</td>                                                       
                                                                                </tr>
                                                                            </template>
                                                                        </tbody>
                                                                    </table>                                                                    
                                                                </div>                                        
                                                            </td>                     
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                            <br>
                                            <div if:true={wp.tmsRecord.haveVPOs}><b>Vehicle Purchase Order</b></div>  
                                            <div if:false={wp.tmsRecord.haveVPOs}><b>There is no record of Vehicle Purchase Order</b></div> 
                                            <table if:true={wp.tmsRecord.haveVPOs}>
                                                <thead>
                                                    <tr class="slds-line-height_reset first">
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Name">Name</div>
                                                        </th>
                                                        <th class="" scope="col">
                                                            <div class="slds-truncate" title="Created Date">Created Date</div>
                                                        </th>
                                                        
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                    <template for:each={wp.vpoList} for:item="vpo">
                                                        <tr key={vpo.Id}>
                                                            <td>
                                                                <lightning-tile label={vpo.Name} href={vpo.nameUrl}>

                                                                </lightning-tile>
                                                            
                                                            </td>
                                                            <td>{vpo.CreatedDate}</td>     
                                                                                                                
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>                                        
                                    </td>                     
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </template>
        </div>
    </div>
</template>