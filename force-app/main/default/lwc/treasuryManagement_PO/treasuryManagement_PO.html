<template>
    <article class="slds-card">
        <div class="slds-card__header slds-grid">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__figure">
                    <span class="slds-icon_container">
                        <lightning-icon icon-name="standard:contract" size="medium" variant="slds-icon-inverse"></lightning-icon>
                    </span>
                </div>
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title">
                        <span>Stock Vehicle Masters <template if:true={recordsCnt}>({recordsCnt})</template></span>
                    </h2>
                </div>
                <div class="slds-no-flex">
                    <p class="slds-p-vertical_xxx-small" style="font-weight: bold;">Filters</p>
                    <div class="slds-grid slds-align_absolute-center">
                        <div class="slds-col">
                            <lightning-input type="checkbox"
                                             label="FOB Completed"
                                             name="FOB_Done__c"
                                             data-api="FOB_Done__c"
                                             data-id="filters"
                                             onchange={handleFilter}></lightning-input>
                        </div>
                        <div class="slds-col">
                            <lightning-input type="checkbox"
                                             label="Duty Completed"
                                             name="Duty_Done__c"
                                             data-api="Duty_Done__c"
                                             data-id="filters"
                                             onchange={handleFilter}></lightning-input>
                        </div>
                        <div class="slds-col">
                            <lightning-button label="Reset Filter"
                                              slot="actions"
                                              variant="brand"
                                              onclick={handleResetFilter}></lightning-button>
                        </div>
                    </div>
                </div>
            </header>
        </div>
        <div class="slds-card__body" style="height: 30rem;">
            <template if:true={selectedStocksCnt}>
                <div class="slds-grid slds-p-left_x-small">
                    <div class="slds-col slds-align-bottom">
                        <p class="slds-text-body--small">{selectedStocksCnt} items selected</p>
                    </div>
                </div>
            </template>
            <lightning-datatable key-field="id"
                                data={data}
                                columns={columns}
                                show-row-number-column
                                row-number-offset={rowOffset}
                                enable-infinite-loading={enableInfiniteLoading}
                                is-loading={tableLoading}
                                onloadmore={loadMoreData}
                                onrowselection={getSelectedRow}>
            </lightning-datatable>
        </div>
        <footer class="slds-card__footer">
          <p slot="footer" style="font-weight: bold;">{loadMoreStatus}</p>
          <div class="slds-no-flex" style="text-align: right;">
                <lightning-button label="Create Forward Contract FOB"
                                  slot="actions"
                                  onclick={openModal}
                                  data-obj="Forward_FOB_Contract__c"
                                  data-obj-line-item="Forward_FOB_Contract_Line_Item__c"></lightning-button>
                <template if:true={showForwardContractDuty}>
                <lightning-button label="Create Forward Contract Duty"
                                  slot="actions"
                                  onclick={openModal}
                                  data-obj="Forward_Duty_Contract__c"
                                  data-obj-line-item="Forward_Duty_Contract_Line_Item__c"></lightning-button>
                </template>
            </div>
        </footer>
    </article>
    <template if:true={showModal}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close"
                                        alternative-text="close"
                                        variant="inverse"
                                        size="small"></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">New Forward Contract</h2>
                </header>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <template if:true={spinner}>
                        <lightning-spinner variant="brand" size="large"></lightning-spinner>
                    </template>
                    <div class="slds-grid slds-grid_vertical">
                        <template for:each={buyContractInputs} for:item="input">
                            <div class="slds-col" key={input.api}>
                                <template if:true={input.isPicklist}>
                                    <lightning-combobox name={input.api}
                                                        label={input.label}
                                                        options={input.options}
                                                        value={input.value}
                                                        onchange={handleChange}
                                                        required={input.required}
                                                        disabled={input.disabled}></lightning-combobox>
                                </template>
                                <template if:false={input.isPicklist}>
                                    <template if:false={input.isTextArea}>
                                        <lightning-input type={input.type}
                                                         name={input.api}
                                                         label={input.label}
                                                         formatter={input.formatter}
                                                         step={input.step}
                                                         value={input.value}
                                                         onchange={handleChange}
                                                         required={input.required}
                                                         disabled={input.disabled}></lightning-input>
                                    </template>
                                    <template if:true={input.isTextArea}>
                                        <lightning-textarea name={input.api}
                                                            label={input.label}
                                                            onchange={handleChange}
                                                            required={input.required}
                                                            disabled={input.disabled}></lightning-textarea>
                                    </template>
                                </template>
                            </div>
                        </template>
                    </div>
                    <lightning-button class="slds-p-around_x-small"
                                      label="Save"
                                      variant="brand"
                                      style="float: right;"
                                      onclick={handleSubmit}>
                    </lightning-button>
                    <lightning-button class="slds-p-around_x-small"
                                      label="Cancel"
                                      variant="neutral"
                                      style="float: right;"
                                      onclick={closeModal}>
                    </lightning-button>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
</template>