<template>
    <!--  ERROR POPUP MODAL   -->
    <template if:true={showModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
            <div class="slds-modal__container">   
                <div class="slds-modal__content slds-p-around_large slds-p-top_small" style="border-radius: 8px; box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1); margin: 0 -5px 0 -5px;" id="modal-content-id-1">
                    <div class="slds-text-align_center">
                        <template if:false={isResendOTP}>
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M11 6C11 5.44772 11.4477 5 12 5C12.5523 5 13 5.44772 13 6V14C13 14.5523 12.5523 15 12 15C11.4477 15 11 14.5523 11 14V6Z" fill="#F85359"></path>
                                <path d="M11 18C11 17.4477 11.4477 17 12 17C12.5523 17 13 17.4477 13 18C13 18.5523 12.5523 19 12 19C11.4477 19 11 18.5523 11 18Z" fill="#F85359"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0C18.6274 0 24 5.37258 24 12ZM22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" fill="#F85359"></path>
                            </svg>
                        </template>
                        <template if:true={isResendOTP}>
                            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <ellipse cx="33" cy="52.5" rx="29" ry="4.5" fill="#CDE5F4"/>
                                <path d="M16.7287 15.6815C16.885 14.7124 17.7216 14 18.7032 14H58.6515C59.8832 14 60.8221 15.1025 60.626 16.3185L56.2712 43.3185C56.1148 44.2876 55.2783 45 54.2967 45H14.3484C13.1167 45 12.1778 43.8975 12.3739 42.6815L16.7287 15.6815Z" fill="white"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.7415 15.5223C15.9759 14.0686 17.2307 13 18.7032 13H58.6515C60.499 13 61.9074 14.6538 61.6132 16.4777L57.2584 43.4777C57.0239 44.9314 55.7691 46 54.2967 46H14.3484C12.5009 46 11.0925 44.3462 11.3866 42.5223L15.7415 15.5223ZM18.7032 15C18.2124 15 17.7941 15.3562 17.716 15.8408L13.3611 42.8408C13.2631 43.4487 13.7325 44 14.3484 44H54.2967C54.7875 44 55.2057 43.6438 55.2839 43.1592L59.6387 16.1592C59.7368 15.5513 59.2673 15 58.6515 15H18.7032Z" fill="#00619E"></path>
                                <path d="M33.1314 32.8694C33.8007 33.5295 34.8392 33.6344 35.627 33.1216L59.353 17.6761C61.0208 16.5904 60.252 14 58.2618 14H18.8758C17.0874 14 16.1981 16.168 17.4714 17.4239L33.1314 32.8694Z" fill="#CDE5F4"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M16.7693 18.1359C14.8593 16.2521 16.1932 13 18.8759 13H58.2619C61.2471 13 62.4004 16.8855 59.8986 18.5142L36.1726 33.9597C34.991 34.7289 33.4331 34.5715 32.4293 33.5814L16.7693 18.1359ZM18.8759 15C17.9817 15 17.537 16.084 18.1737 16.712L33.8337 32.1575C34.1683 32.4875 34.6876 32.54 35.0815 32.2836L58.8075 16.8381C59.6414 16.2952 59.257 15 58.2619 15H18.8759Z" fill="#00619E"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M31.8108 30.4145C32.1341 30.8622 32.0333 31.4873 31.5856 31.8107L13.5856 44.8107C13.1378 45.134 12.5128 45.0332 12.1894 44.5855C11.866 44.1378 11.9669 43.5127 12.4146 43.1893L30.4146 30.1893C30.8623 29.866 31.4874 29.9668 31.8108 30.4145Z" fill="#00619E"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M39.7689 29.3177C40.1458 28.9139 40.7786 28.8921 41.1823 29.2689L56.1823 43.2689C56.5861 43.6458 56.6079 44.2786 56.2311 44.6823C55.8542 45.0861 55.2214 45.1079 54.8177 44.7311L39.8177 30.7311C39.4139 30.3542 39.3921 29.7214 39.7689 29.3177Z" fill="#00619E"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M22 9C22 8.44772 22.4477 8 23 8H31C31.5523 8 32 8.44772 32 9C32 9.55228 31.5523 10 31 10H23C22.4477 10 22 9.55228 22 9Z" fill="#CDE5F4"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M3 15C3 14.4477 3.44772 14 4 14L13 14C13.5523 14 14 14.4477 14 15C14 15.5523 13.5523 16 13 16L4 16C3.44772 16 3 15.5523 3 15Z" fill="#CDE5F4"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M7 27C7 26.4477 7.44772 26 8 26L12 26C12.5523 26 13 26.4477 13 27C13 27.5523 12.5523 28 12 28L8 28C7.44772 28 7 27.5523 7 27Z" fill="#CDE5F4"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4 44C4 43.4477 4.44772 43 5 43L8 43C8.55228 43 9 43.4477 9 44C9 44.5523 8.55228 45 8 45L5 45C4.44772 45 4 44.5523 4 44Z" fill="#CDE5F4"></path>
                            </svg>
                        </template>
                    </div>
                    <p class="page-subtitle" style="padding: 15px 0px 0px 0px;">{modalMsg}</p>
                    <div>
                        <button style="width:100%; margin-top: 25px;" type="button" class="slds-button slds-button_brand button-element slds-p-bottom_x-small" onclick={closeModal}>
                            {buttonText}
                        </button>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" style="background-color: rgba(255, 255, 255, 0.8);"></div>
    </template>
    <!--  ERROR POPUP MODAL   -->
    <!--  T&C POPUP MODAL   -->
    <template if:true={showTCModal}>
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_large" aria-labelledby="modal-heading-02" aria-modal="true" aria-describedby="modal-content-id-2">
            <div style="height: 100%; overflow: auto; text-align:left">   
                <header class="slds-modal__header slds-p-left_large" style="top: 0px; position:sticky;border:none;outline:none;text-align:left; padding-bottom: 5px;">
                    <div style="float:right;">
                        <lightning-button-icon  class="slds-button slds-input__icon slds-text-color--default" 
                                                icon-name="utility:close"
                                                variant = "bare" 
                                                size="large"
                                                onclick={closeModal}>
                        </lightning-button-icon>  
                    </div>
                    <br/>
                    <br/>
                    <br/>
                </header>
                <div class="slds-p-top_small slds-p-right_large slds-p-bottom_large slds-p-left_large" id="modal-content-id-2">
                    <div style="font-family: Gotham; font-size: 22px;line-height: 24px;color: #000000;padding-bottom:20px;">
                        Terms &amp; Conditions                  
                    </div>
                    <p style="font-family: Whitney;font-size: 18px;line-height: 22px;color: #000000; padding-bottom:15px;">
                        I understand that notwithstanding the above, marketing and promotional information may be sent to me by push and/or pop-up notifications through JCCL's mobile application(s) should I install the application(s) on my mobile device. I agree that by enabling push and/or pop-up notifications in my device or mobile application settings, I consent to receiving such marketing and promotional information.
                    </p>
                    <p style="font-family: Whitney;font-size: 18px;line-height: 22px;color: #000000; padding-bottom:15px;">
                        My consent above is voluntarily given and I am aware that I may withdraw my consent at any time by sending a notification to Cycle &amp; Carriage Customer Assistance at <a style="word-break: break-word;" href="mailto:CustomerAssistanceCentre@cyclecarriage.com.sg">CustomerAssistanceCentre@cyclecarriage.com.sg</a>, and/or to JCCL through the channels stated in JCCL's Privacy Statement. I have read and understood the Privacy Statement and been acquainted with my right to access my personal data. I have checked and do confirm that personal data I have provided is true, complete and accurate.
                    </p>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open" style="background-color: white;"></div>
    </template>
    <!--  T&C POPUP MODAL   -->
    <div class="slds-is-relative">
        <div class="container">
            <!--  SPINNER   -->
            <template if:true={spinner}>
                <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
            </template>
            <!--  SPINNER -->
            <!--  HEADER BUTTON -->
            <div class="slds-p-top_medium">
                <a href="javascript: if (history.length > 1) {history.back();} else {location.href='prelogin-screen';}">
                    <lightning-button-icon icon-name="utility:chevronleft" size="large" variant="bare" alternative-text="Back" title="Back"></lightning-button-icon>
                </a>
            </div>  
            <!--  HEADER BUTTON -->       
            <div class="slds-grid slds-wrap slds-grid_align-center slds-p-around_small">
                <div class="slds-size_full">
                    <!-- FIRST PAGE -->
                    <template if:true={isFirstPage}>
                        <div class="slds-col slds-size_1-of-1">
                            <div>
                                <p class="page-title">Create your C&amp;C ID</p>
                                <p class="page-subtitle">Single login to access all your Cycle &amp; Carriage services.</p>
                            </div>
                        </div>
                        <br/>
                            <!-- CHECK EMAIL-->
                        <div class="slds-col slds-size_1-of-1">                                   
                            <div>  
                                <p class="help-text">This email will be your C&amp;C ID.</p>     
                                <div class="input-element" data-id="email input element"> 
                                    <label class="input-label" data-id="email input label">Email</label>
                                    <div class="input-container">
                                        <input  style={inputStyle}
                                                type="email" readonly={isRead}
                                                id="email" required
                                                name="email"
                                                data-id="email"
                                                aria-describedby="emailHelp" 
                                                onchange={onValueChanged}
                                                onfocus={onFocusEvent}
                                                onblur={onBlurEvent}/> 
                                    </div>
                                    <p class="input-message" data-id="email" style="color: #F85359; display:none;"></p>     
                                    <template if:true={isEmailSuccess}>
                                        <div style="padding-top:5px">
                                            <lightning-icon  class="success-icon"
                                                            icon-name="utility:success"
                                                            size="x-small">
                                            </lightning-icon>  
                                            &nbsp;<span style="font-family: Whitney;font-size: 15px;line-height: 18px;color: #39B54A;">This email is available</span>
                                        </div>
                                    </template>
                                </div> 
                            </div>                                       
                        </div>
                        <!-- CHECK AVAILABILITY BUTTON -->
                        <template if:true={isCheckEmail}>
                            <div>     
                                <div class="slds-col slds-size_1-of-1">
                                    <div>
                                        <button style="width:100%; margin-top: 25px;" type="button" class="slds-button slds-button_brand button-element" onclick={checkEmail}>
                                            CHECK AVAILABILITY
                                        </button>
                                    </div>
                                </div>   
                            </div>
                        </template>
                        <!-- SIGNUP FORM-->
                        <template if:true={showSignupForm}>
                            <div class="slds-col slds-size_1-of-1 slds-p-top_x-large">
                                <div>     
                                    <div><span class="help-text">All fields are mandatory.</span></div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-p-top_small">
                                <div>
                                    <div class="input-element" data-id="first name input element">
                                        <label class="input-label" data-id="first name input label">First Name</label>      
                                        <div class="input-container">  
                                            <input  style={inputStyle}
                                                    type="text"  maxlength="40"
                                                    id="firstName" required
                                                    name="firstName"
                                                    data-id="first name"
                                                    aria-describedby="firstNameHelp" 
                                                    onchange={onValueChanged}
                                                    onfocus={onFocusEvent}
                                                    onblur={onBlurEvent}>    
                                        </div>   
                                        <p class="input-message" data-id="first name" style="color: #F85359; display:none;"></p>                                                                                                                                                                          
                                    </div>     
                                </div>                                       
                            </div>      
                            <div class="slds-col slds-size_1-of-1 slds-p-top_small">
                                <div> 
                                    <div class="input-element" data-id="last name input element">
                                        <label class="input-label" data-id="last name input label">Last Name</label>      
                                        <div class="input-container">  
                                            <input style={inputStyle}
                                                    type="text" required
                                                    id="lastName" maxlength="60"
                                                    name="lastName"
                                                    data-id="last name"
                                                    aria-describedby="lastNameHelp" 
                                                    onchange={onValueChanged}
                                                    onfocus={onFocusEvent}
                                                    onblur={onBlurEvent}> 
                                        </div>      
                                        <p class="input-message" data-id="last name" style="color: #F85359; display:none;"></p>                                                                                                                                                           
                                    </div>
                                </div>                                       
                            </div>
                            <div class="slds-col slds-size_1-of-1 slds-p-top_small">
                                <div> 
                                    <div class="input-element" data-id="password input element">
                                        <label class="input-label" data-id="password input label">Password</label>      
                                        <div class="input-container">  
                                            <input  style={inputStyle}
                                                    type="password"
                                                    onchange={onValueChanged} 
                                                    onfocus={onFocusEvent}
                                                    onblur={onBlurEvent}
                                                    name="password"  
                                                    data-id="password" 
                                                    id="password" 
                                                    aria-describedby="passwordHelp" required>    
                                            <lightning-button-icon  class="slds-button slds-input__icon slds-text-color--default field-icon" 
                                                                    icon-name={showPassword} 
                                                                    variant = "bare" icon-class="slds-icon-text-default"
                                                                    size="large"
                                                                    onclick={togglePassword}>
                                            </lightning-button-icon>  
                                        </div>      
                                        <p class="input-message" data-id="password" style="color: #F85359; display:none;"></p>                                                                                                                                                 
                                    </div>
                                    <p class="slds-p-top_x-small" style="font-family: Whitney;font-size: 12px;line-height: 14px;color: #314959;">Min. 8 characters, with at least one uppercase letter and one number.</p><br/>      
                                </div>                                       
                            </div>   
                            <div class="slds-col slds-size_1-of-1 slds-p-top_small">
                                <div class="">   
                                    <div class="slds-form-element">
                                        <div class="slds-form-element__control slds-grid slds-wrap">
                                            <div class="slds-col slds-size_1-of-12 slds-large-size_1-of-12 slds-align-top" style="width:auto;">
                                                <label class="slds-checkbox-button pdpa-checkbox" for="example-unique-id-144" data-id="pdpa label">
                                                    <input type="checkbox" name="pdpa" class="slds-assistive-text" id="example-unique-id-144" value="example-unique-id-144" onchange={onValueChanged}/>
                                                    <span class="slds-icon_container slds-icon-utility-check slds-current-color" title="Description of icon when needed">
                                                        <svg class="slds-icon slds-icon_x-small" aria-hidden="true" width="14" height="11" viewBox="0 0 14 11" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M13.7326 1.17732C14.0891 1.52487 14.0891 2.08836 13.7326 2.43591L5.38475 10.5727C5.02818 10.9202 4.45008 10.9202 4.09351 10.5727L0.267424 6.84332C-0.0891414 6.49577 -0.0891414 5.93228 0.267424 5.58473C0.62399 5.23718 1.2021 5.23718 1.55866 5.58473L4.73913 8.68478L12.4413 1.17732C12.7979 0.829769 13.376 0.829769 13.7326 1.17732Z" fill="white"></path>
                                                        </svg>
                                                        <span class="slds-assistive-text">Agree</span>
                                                    </span>                                   
                                                </label>
                                            </div>&nbsp;&nbsp;
                                            <div class="slds-col slds-size_11-of-12 slds-large-size_11-of-12 input-message pdpa-consent" style="width: 87%; color: #001C2D; font-size:15px;">
                                                I wish to receive information about promotions, events and products and services, and marketing-related customer surveys ("marketing and promotional information") from JCCL. I consent to the collection, use and disclosure of my personal data for such marketing purposes by JCCL and its agents.&nbsp;<a href="javascript:;" onclick={handleTC}>Read more.</a>
                                            </div>      
                                        </div>
                                    </div>    
                                </div>                                       
                            </div>     
                            <br />
                            <div class="slds-col slds-size_1-of-1">
                                <iframe data-id="vfFrame" class="captcha" src={vfURL} width="100%" scrolling="no" style="border: none"></iframe>
                                <template if:true={showCaptchaMsg}>
                                    <div>     
                                        <p class="input-message" style="color: #F85359; text-align:center;">{captchaMsg}</p>
                                    </div>
                                </template>
                            </div>
                            <br /> 
                            <!-- CREATE ID BUTTON -->
                            <div>     
                                <div class="slds-col slds-size_1-of-1">
                                    <div>
                                        <button style="width:100%; margin-top: 10px;" type="button" class="slds-button slds-button_brand button-element" onclick={doSubmit}>
                                            NEXT
                                        </button>
                                    </div>
                                </div>   
                            </div>
                        </template>
                    </template>
                    <!-- SECOND PAGE -->
                    <template if:true={isSecondPage}>
                        <div class="slds-col slds-size_1-of-1">
                            <div>
                                <p class="page-title">Verify your email</p>
                                <p class="page-subtitle">Please enter the code sent to</p>
                                <p class="page-subtitle" style="font-weight:bold"><b>{details.email}</b></p>
                            </div>
                        </div>
                        <div class="slds-col">                                   
                            <div>  
                                <div class="slds-grid slds-grid_align-spread">
                                    <div class="slds-col slds-size_1-of-6">
                                        <div class="input-element-verify"> 
                                            <input style={inputStyleVerify} data-id="0" name="0" type="tel" id="1"  maxlength="1" aria-describedby="optHelp" onkeyup={onKeyUpCode} onfocus={onFocusEvent} onblur={onBlurEvent}>
                                        </div> 
                                    </div>
                                    <div class="slds-col slds-size_1-of-6">
                                        <div class="input-element-verify"> 
                                            <input style={inputStyleVerify} data-id="1" name="1" type="tel" id="2" maxlength="1" aria-describedby="optHelp" onkeyup={onKeyUpCode} onfocus={onFocusEvent} onblur={onBlurEvent}>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-6">
                                        <div class="input-element-verify"> 
                                            <input style={inputStyleVerify} data-id="2" name="2" type="tel" id="3" maxlength="1" aria-describedby="optHelp" onkeyup={onKeyUpCode} onfocus={onFocusEvent} onblur={onBlurEvent}>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-6"> 
                                        <div class="input-element-verify"> 
                                            <input style={inputStyleVerify} data-id="3" name="3" type="tel" id="4" maxlength="1" aria-describedby="optHelp" onkeyup={onKeyUpCode} onfocus={onFocusEvent} onblur={onBlurEvent}>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-6">
                                        <div class="input-element-verify"> 
                                            <input style={inputStyleVerify} data-id="4" name="4" type="tel" id="5" maxlength="1" aria-describedby="optHelp" onkeyup={onKeyUpCode} onfocus={onFocusEvent} onblur={onBlurEvent}>
                                        </div>
                                    </div>
                                    <div class="slds-col slds-size_1-of-6">
                                        <div class="input-element-verify"> 
                                            <input style={inputStyleVerify} data-id="5" name="5" type="tel" id="6" maxlength="1" aria-describedby="optHelp" onkeyup={onKeyUpCode} onfocus={onFocusEvent} onblur={onBlurEvent}>
                                        </div>
                                    </div>
                                </div>   
                            </div>                                       
                        </div>  
                        <div class="slds-col slds-size_1-of-1">
                            <div>
                                <div  style="text-align:center;"> 
                                    <p class="input-message">Didn't receive OTP?</p>
                                    <button class="slds-button input-message" type="button" onclick={resendOTP}>Resend</button>
                                </div>
                            </div>       
                        </div>  
                    </template>
                </div>
            </div>
        </div>
    </div>
</template>